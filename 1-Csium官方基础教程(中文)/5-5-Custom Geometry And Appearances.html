<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.74/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.74/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    // Your access token can be found at: https://cesium.com/ion/tokens.
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkYmEwNWZmMC1lZTlhLTQ0YzQtYTk5OS04MjY0MzgyMmE3MGQiLCJpZCI6MTQ0NzcsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NjU2NTkwOTZ9.gimVCxsdX7dVIJBhUPO4rHUZh6iHvH-orUikRWlTT9w';
    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer');
    var scene = viewer.scene;

    // var instance = new Cesium.GeometryInstance({
    //     geometry : new Cesium.RectangleGeometry({
    //         rectangle : Cesium.Rectangle.fromDegrees(-100.0, 20.0, -90.0, 30.0),
    //         vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT
    //     }),
    //     attributes : {
    //         color : new Cesium.ColorGeometryInstanceAttribute(0.0, 0.0, 1.0, 0.8)
    //     }
    // });
    //
    // var anotherInstance = new Cesium.GeometryInstance({
    //     geometry : new Cesium.RectangleGeometry({
    //         rectangle : Cesium.Rectangle.fromDegrees(-85.0, 20.0, -75.0, 30.0),
    //         vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT
    //     }),
    //     attributes : {
    //         color : new Cesium.ColorGeometryInstanceAttribute(1.0, 0.0, 0.0, 0.8)
    //     }
    // });
    //
    // scene.primitives.add(new Cesium.Primitive({
    //     geometryInstances : [instance,anotherInstance],
    //     //单独设置样式
    //     appearance : new Cesium.PerInstanceColorAppearance()
    //     //统一设置样式
    //     // appearance : new Cesium.EllipsoidSurfaceAppearance({
    //     //     material : Cesium.Material.fromType('Stripe')
    //     // })
    // }));

    //添加多个geometry
    // var instances = [];
    // for (var lon = -180.0; lon < 180.0; lon += 5.0) {
    //     for (var lat = -85.0; lat < 85.0; lat += 5.0) {
    //         instances.push(new Cesium.GeometryInstance({
    //             geometry : new Cesium.RectangleGeometry({
    //                 rectangle : Cesium.Rectangle.fromDegrees(lon, lat, lon + 5.0, lat + 5.0),
    //                 vertexFormat: Cesium.PerInstanceColorAppearance.VERTEX_FORMAT
    //             }),
    //             attributes : {
    //                 color : Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom({alpha : 0.5}))
    //             }
    //         }));
    //     }
    // }
    //
    // scene.primitives.add(new Cesium.Primitive({
    //     geometryInstances : instances,
    //     appearance : new Cesium.PerInstanceColorAppearance()
    // }));

   //modelmatrix,一个Geometry,多个instances
    var ellipsoidGeometry = new Cesium.EllipsoidGeometry({
        vertexFormat : Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
        radii : new Cesium.Cartesian3(300000.0, 200000.0, 150000.0)
    });

    var cyanEllipsoidInstance = new Cesium.GeometryInstance({
        id:"gi_1",
        geometry : ellipsoidGeometry,
        modelMatrix : Cesium.Matrix4.multiplyByTranslation(
            Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(-100.0, 40.0)),
            new Cesium.Cartesian3(0.0, 0.0, 150000.0),
            new Cesium.Matrix4()
        ),
        attributes : {
            color : Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.CYAN)
        }
    });

    var orangeEllipsoidInstance = new Cesium.GeometryInstance({
        id:"gi_2",
        geometry : ellipsoidGeometry,
        modelMatrix : Cesium.Matrix4.multiplyByTranslation(
            Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(-100.0, 40.0)),
            new Cesium.Cartesian3(0.0, 0.0, 450000.0),
            new Cesium.Matrix4()
        ),
        attributes : {
            color : Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.ORANGE)
        }
    });

    var primitive = new Cesium.Primitive({
        geometryInstances : [cyanEllipsoidInstance, orangeEllipsoidInstance],
        appearance : new Cesium.PerInstanceColorAppearance({
            translucent : false,
            closed : true
        })
    });

    scene.primitives.add(primitive);

    setInterval(function() {
        var attributes = primitive.getGeometryInstanceAttributes('gi_1');
        attributes.color = Cesium.ColorGeometryInstanceAttribute.toValue(Cesium.Color.fromRandom({alpha : 1.0}));
    },2000);

  </script>
 </div>
</body>
</html>